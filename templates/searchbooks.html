{% extends "base.html" %}

{% block title %}
Search Books
{% endblock %}

{% block style %}
<!-- loader css  -->
<style type="text/css">
    @keyframes ldio-cy282x9qsxi-1 {
        0% {
            top: 9.262999999999998px;
            height: 138.47400000000002px
        }

        50% {
            top: 40.035000000000004px;
            height: 76.93px
        }

        100% {
            top: 40.035000000000004px;
            height: 76.93px
        }
    }

    @keyframes ldio-cy282x9qsxi-2 {
        0% {
            top: 16.955999999999996px;
            height: 123.08800000000001px
        }

        50% {
            top: 40.035000000000004px;
            height: 76.93px
        }

        100% {
            top: 40.035000000000004px;
            height: 76.93px
        }
    }

    @keyframes ldio-cy282x9qsxi-3 {
        0% {
            top: 24.649000000000004px;
            height: 107.702px
        }

        50% {
            top: 40.035000000000004px;
            height: 76.93px
        }

        100% {
            top: 40.035000000000004px;
            height: 76.93px
        }
    }

    .ldio-cy282x9qsxi div {
        position: absolute;
        width: 18.84px
    }

    .ldio-cy282x9qsxi div:nth-child(1) {
        left: 29.830000000000002px;
        background: #e1bc29;
        animation: ldio-cy282x9qsxi-1 1.075268817204301s cubic-bezier(0, 0.5, 0.5, 1) infinite;
        animation-delay: -0.21505376344086022s
    }

    .ldio-cy282x9qsxi div:nth-child(2) {
        left: 69.08px;
        background: #e15554;
        animation: ldio-cy282x9qsxi-2 1.075268817204301s cubic-bezier(0, 0.5, 0.5, 1) infinite;
        animation-delay: -0.10752688172043011s
    }

    .ldio-cy282x9qsxi div:nth-child(3) {
        left: 108.33px;
        background: #4d9de0;
        animation: ldio-cy282x9qsxi-3 1.075268817204301s cubic-bezier(0, 0.5, 0.5, 1) infinite;
        animation-delay: undefineds
    }

    .loadingio-spinner-pulse-4p4kjtcdaqq {
        width: 157px;
        height: 157px;
        display: inline-block;
        overflow: hidden;
        background: #ffffff;
    }

    .ldio-cy282x9qsxi {
        width: 100%;
        height: 100%;
        position: relative;
        transform: translateZ(0) scale(1);
        backface-visibility: hidden;
        transform-origin: 0 0;
        /* see note above */
    }

    .ldio-cy282x9qsxi div {
        box-sizing: content-box;
    }

    /* generated by https://loading.io/ */
</style>
{% endblock %}

{% block content %}

<div class="bg-white pt-24 p-2" style="min-height:100vh">
    <main class="my-8">
        <div class="container mx-auto px-6">
            <div class="flex">
                <div class="relative mt-6 max-w-lg ml-auto">
                    <span class="absolute inset-y-0 left-0 pl-3 flex items-center">
                        <svg class="h-5 w-5 text-gray-500" viewBox="0 0 24 24" fill="none">
                            <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </span>

                    <input class="w-full border rounded-md pl-10 pr-4 py-2 focus:border-blue-500 focus:outline-none focus:shadow-outline" type="text" id="searchIp" placeholder="Search Book">
                </div>
                <button class="bg-indigo-500 text-white mt-6 rounded-md p-2 mx-4 font-semibold" id="searchBtn">Search</button>
                <hr class="my-3">
            </div>
            <div class="grid grid-cols-4 gap-4" id="book-results">
            </div>
        </div>
    </main>

</div>

{% endblock %}

{% block script %}
<script>
    var searchIp = document.getElementById("searchIp");
    var searchBtn = document.getElementById("searchBtn");
    searchBtn.addEventListener("click", () => {
        getbooks(searchIp.value);
    });

    async function getbooks(q) {
        let url = "https://openlibrary.org/search.json?title=" + q;
        var rescontainer = document.getElementById("book-results")
        rescontainer.innerHTML = '<div class="text-center mt-6 col-span-4"><div class="loadingio-spinner-pulse-4p4kjtcdaqq"><div class="ldio-cy282x9qsxi"><div></div><div></div><div></div></div></div></div>'
        await fetch(url).then((response) => {

            let data = response.json().then((res) => {
                console.log(url);
                try {
                    rescontainer.innerHTML = ""
                    console.log(res.docs[0].title);
                    console.log(res.docs);
                    for (let i = 0; i < 10; i++) {

                        let book = ''
                        if (res.docs[i].isbn) {
                            book = '<div class=" bg-white flex items-center justify-center"><div class="bg-white rounded-xl overflow-hidden shadow-xl hover:scale-105 hover:shadow-2xl transform duration-500 cursor-pointer"><div class="p-4"><h1 class="mt-4 text-lg h-12 font-bold hover:underline cursor-pointer">' + res.docs[i].title + '</h1><p class="mt-2 font-sans text-gray-700 text-sm">by ' + res.docs[i].author_name + '</p></div><div class="relative"><img class="w-80" style="height:400px" src="https://covers.openlibrary.org/b/isbn/' + res.docs[i].isbn[0] + '-L.jpg" onerror=this.src="https://images.unsplash.com/photo-1571167530149-c1105da4c2c7?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=376&q=80"/><p class="absolute text-lg transform translate-x-20 -translate-y-24 bg-blue-600 text-white py-3 px-6 rounded-full cursor-pointer hover:scale-105 duration-500">Check Book</p></div></div></div> '
                        } else {
                            book = '<div class=" bg-white flex items-center justify-center"><div class="bg-white rounded-xl overflow-hidden shadow-xl hover:scale-105 hover:shadow-2xl transform duration-500 cursor-pointer"><div class="p-4"><h1 class="mt-4 text-lg h-12 font-bold hover:underline cursor-pointer">' + res.docs[i].title + '</h1><p class="mt-2 font-sans text-gray-700 text-sm">by ' + res.docs[i].author_name + '</p></div><div class="relative"><img class="w-80" style="height:400px" src="https://images.unsplash.com/photo-1571167530149-c1105da4c2c7?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=376&q=80" /><p class="absolute text-lg transform translate-x-20 -translate-y-24 bg-blue-600 text-white py-3 px-6 rounded-full cursor-pointer hover:scale-105 duration-500">Check Book</p></div></div></div> '
                        }
                        // var li = document.createElement('li');
                        // li.classList.add("p-2", "bg-gray-200", "shadow-lg", "my-1")
                        // li.innerHTML = i + 1 + ". <span class='font-bold mr-4'>" + res.docs[i].title + "</span><span class='text-gray-800'> by " + res.docs[i].author_name + " [ " + res.docs[i].language + " ]</span>"
                        // list.appendChild(li)
                        rescontainer.innerHTML += book;
                    }
                } catch (error) {
                    console.log(error);
                }
            });

        }).catch((error) => {
            // handle the error
            console.log(error);
        });
    }
</script>
{% endblock %}